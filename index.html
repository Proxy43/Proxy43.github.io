<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>島間電鉄 Robloxゲーム用 アナウンス</title>
<style>
  body {
    background: #001022;
    color: #cfffd8;
    font-family: "Segoe UI", sans-serif;
    text-align: center;
    padding: 40px;
  }
  h1 {
    margin-bottom: 1em;
  }
  #stationName, #led, #category {
    font-family: monospace;
    background: #002033;
    padding: 15px;
    margin: 12px auto;
    border-radius: 8px;
    width: 90%;
    max-width: 700px;
    box-shadow: 0 0 15px #00ffa5;
  }
  #stationName {
    font-size: 2em;
  }
  #led {
    color: #00ff00;
    font-size: 1.4em;
  }
  #category {
    font-weight: bold;
    font-size: 1.2em;
  }
  .announce {
    margin: 12px 0;
    font-size: 1.3em;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
  button {
    background: #004466;
    color: #ccffcc;
    border: none;
    padding: 12px 28px;
    margin: 10px 6px;
    font-size: 1em;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 6px #00ff88;
  }
  button:hover:enabled {
    background: #006688;
  }
  button:disabled {
    background: #003344;
    cursor: default;
    box-shadow: none;
  }
</style>
</head>
<body>

  <h1>🚉 島間電鉄 Robloxゲーム用 アナウンス</h1>

  <div id="category">カテゴリ：--</div>
  <div id="stationName">現在の駅：--</div>
  <div id="led">LED表示：--</div>

  <div class="announce" id="jp">---</div>
  <div class="announce" id="en">---</div>

  <button id="nextBtn" onclick="manualPlay()">▶ 次の通常アナウンス</button>
  <button id="stopBtn" onclick="stopAnnouncement()" disabled>⏹ 中断</button>
  <button id="startBtn" onclick="startAutoAnnouncements()">▶ 自動再生開始</button>

<script>
  const announcements = {
    normal: [
      {
        category: "通常",
        name: "潮風港（しおかぜこう）",
        led: "潮風港　始発駅　出発します",
        jp: "次は、潮風港。始発駅です。まもなく発車いたします。",
        en: "Next stop: Shiokaze Port. This is the first station. We will be departing shortly."
      },
      {
        category: "通常",
        name: "森ノ丘（もりのおか）",
        led: "森ノ丘　右側のドアが開きます",
        jp: "次は、森ノ丘。右側のドアが開きます。自然公園へお越しの方はこちらでお降りください。",
        en: "Next stop: Mori no Oka. Doors will open on the right. This stop is for the Nature Park."
      },
      {
        category: "通常",
        name: "中央島（ちゅうおうじま）",
        led: "中央島　左側のドアが開きます",
        jp: "次は、中央島。左側のドアが開きます。島間ショッピングモールは中央改札をご利用ください。",
        en: "Next stop: Chuo-jima. Doors will open on the left. Please use the central gate for the Shimakan Mall."
      }
    ],
    delay: [
      {
        category: "遅延",
        name: "遅延情報",
        led: "遅延注意　人身事故発生",
        jp: "お知らせします。本日、今朝人身事故が発生しました。宅球場前から柏区間において、多くのお客様にご迷惑をおかけしております。ご了承ください。",
        en: "Attention please. A personal injury accident occurred this morning. Between Takakyujo-mae and Kashiwa sections, many customers are inconvenienced. We apologize for the trouble."
      },
      {
        category: "遅延",
        name: "駅内遅延お詫び",
        led: "遅延お詫び　ご迷惑おかけします",
        jp: "駅構内の遅延に関しまして、ご迷惑をおかけしておりますことを深くお詫び申し上げます。今後の運行にご注意ください。",
        en: "We sincerely apologize for the delay within the station. Please be aware of the upcoming train operations."
      }
    ],
    pass: [
      {
        category: "通過",
        name: "深山駅（みやまえき）",
        led: "深山駅 通過",
        jp: "この電車は深山駅を通過します。ご注意ください。",
        en: "This train will pass Miyama Station. Please be careful."
      },
      {
        category: "通過",
        name: "大川駅（おおかわえき）",
        led: "大川駅 通過",
        jp: "この電車は大川駅を通過します。お急ぎの方はご利用ください。",
        en: "This train will pass Okawa Station. For those in a hurry, please note."
      }
    ]
  };

  let normalIndex = 0;
  let delayIndex = 0;
  let passIndex = 0;

  let normalTimer = null;
  let delayTimer = null;
  let passTimer = null;

  // 共通音声読み上げ関数
  function speak(text, lang, onEnd = null) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    if (onEnd) utterance.onend = onEnd;
    speechSynthesis.speak(utterance);
  }

  // アナウンス再生（ループ）
  function playAnnouncementList(list, index) {
    if (index >= list.length) index = 0;
    const ann = list[index];

    document.getElementById("category").textContent = "カテゴリ：" + ann.category;
    document.getElementById("stationName").textContent = (ann.category === "遅延" || ann.category === "通過" ? "案内：" : "現在の駅：") + ann.name;
    document.getElementById("led").textContent = "LED表示：" + ann.led;
    document.getElementById("jp").textContent = ann.jp;
    document.getElementById("en").textContent = ann.en;

    speak(ann.jp, "ja-JP", () => {
      speak(ann.en, "en-US");
    });

    return index + 1;
  }

  // 自動アナウンス開始
  function startAutoAnnouncements() {
    if (normalTimer || delayTimer || passTimer) return; // すでに動作中は無視

    // ボタン制御
    document.getElementById("startBtn").disabled = true;
    document.getElementById("stopBtn").disabled = false;

    // すぐ一回再生
    normalIndex = playAnnouncementList(announcements.normal, normalIndex);
    delayIndex = playAnnouncementList(announcements.delay, delayIndex);
    passIndex = playAnnouncementList(announcements.pass, passIndex);

    // タイマー開始
    normalTimer = setInterval(() => {
      normalIndex = playAnnouncementList(announcements.normal, normalIndex);
    }, 120000); // 2分

    delayTimer = setInterval(() => {
      delayIndex = playAnnouncementList(announcements.delay, delayIndex);
    }, 300000); // 5分

    passTimer = setInterval(() => {
      passIndex = playAnnouncementList(announcements.pass, passIndex);
    }, 180000); // 3分
  }

  // 中断処理
  function stopAnnouncement() {
    speechSynthesis.cancel();

    if (normalTimer) {
      clearInterval(normalTimer);
      normalTimer = null;
    }
    if (delayTimer) {
      clearInterval(delayTimer);
      delayTimer = null;
    }
    if (passTimer) {
      clearInterval(passTimer);
      passTimer = null;
    }

    document.getElementById("startBtn").disabled = false;
    document.getElementById("stopBtn").disabled = true;
  }

  // 手動通常アナウンス再生
  function manualPlay() {
    normalIndex = playAnnouncementList(announcements.normal, normalIndex);
  }

  // 初期状態ボタン制御
  window.onload = () => {
    document.getElementById("startBtn").disabled = false;
    document.getElementById("stopBtn").disabled = true;
  };
</script>

</body>
</html>
